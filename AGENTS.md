특별한 언급이 없을 경우 반드시 [$structure-first] 사용. 

유니티 2D 턴제 셀 기반 던전크롤러를 만들고 있다.
던전 탐험 씬과 전투 씬은 분리되어 있으며, 탐험 씬에서 적은 능동적으로 행동하지 않고 전투로 진입하는 인카운터 POI 심볼일 뿐이다.

던전은 격자(Grid) 기반이며, 각 셀은 다음 데이터를 가진다:

Terrain(TileId): 벽/바닥/문 등 (walkable, blocksVision)

POI: 인카운터, 상자, 이벤트, 출구 등 (셀당 최대 1개)

Fog: explored / visible

플레이어만 이동하며, 플레이어의 행동 1회 = 탐험 턴 1회이다.
시야는 제한되어 있으며, FOV 계산 후 visible/explored를 갱신한다.

던전은 랜덤 생성되며, 다음 파이프라인을 따른다:

시드 결정(runSeed, floorSeed)

레이아웃 생성 (BSP 기반 방/복도 또는 미로+방 삽입)

연결성 검사 (시작점 → 출구 도달 가능)

시작점 기준 거리맵(BFS) 계산

거리 기반 POI 배치

인카운터: 중·원거리, 분기점 가중치

보상/상자: 데드엔드 또는 위험 지역

출구: 가장 먼 영역

선택적으로 문/열쇠 같은 단순 진행 제약 추가

후처리(데드엔드 조정, 시야 차단 구조물 등)

전투 인카운터는 encounterDefId만을 가지며, 전투 씬 종료 후 결과(BattleResult)에 따라 해당 POI 상태를 cleared/consumed로 변경한다.

이 구조를 전제로,
던전 레이아웃 생성, 거리 기반 POI 배치, 키/문 배치, 연결성 검증 로직을
데이터 중심(C# 순수 로직, Unity 의존 최소)으로 구현하는 데 도움을 제공해 달라.

코딩 스타일: `CODING_STYLE.md` 참고.
